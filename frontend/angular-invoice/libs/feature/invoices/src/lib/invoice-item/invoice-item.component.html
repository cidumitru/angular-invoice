<div class="card">
  <div class="card-header">
    Invoice
    <strong>{{invoice.info.series}} {{invoice.info.number}}</strong>
    <div class="d-inline">
      <span class="float-right"> <strong>Status:</strong> {{invoice.info.status}}</span>
      <button (click)="invoice.toggleEditMode()"
              class="btn btn-sm btn-success ml-2">{{invoice.editMode ? 'Save' : 'Edit'}}</button>
    </div>
  </div>
  <div class="card-body">
    <div class="row mb-4">
      <div class="col-sm-6">
        <h6 class="mb-3">From:</h6>
        <div>
          <strong>Dumitru</strong>
        </div>
      </div>

      <div class="col-sm-6">
        <h6 class="mb-3">To:</h6>
        <div>
          <strong>{{invoice.info.client}}</strong>
        </div>
      </div>


    </div>

    <div class="table-responsive-sm">
      <table class="table table-striped">
        <thead>
        <tr>
          <th class="center">SKU</th>
          <th>Item</th>

          <th class="right">Unit Cost</th>
          <th class="center">Qty</th>
          <th class="right">Total</th>
        </tr>
        </thead>
        <tbody>
        <ng-container [ngTemplateOutlet]="displayProducts"></ng-container>
        </tbody>
      </table>

      <ng-container *ngIf="invoice?.info?.status === invoiceStatuses.draft || invoice?.editMode">
        <h3>Add product to invoice</h3>
        <ngx-select-dropdown
          (change)="addNewProduct($event.value)"
          [config]="{displayKey: 'name', search: true}"
          [options]="stateProducts$ | async">
        </ngx-select-dropdown>
      </ng-container>

    </div>
    <div class="row">
      <div class="col-lg-4 col-sm-5">

      </div>

      <div class="col-lg-4 col-sm-5 ml-auto">
        <table class="table table-clear">
          <tbody>
          <tr>
            <td class="left">
              <strong>Total</strong>
            </td>
            <td class="right">
              <strong>{{invoice.invoiceTotal$ | async}}</strong>
            </td>
          </tr>
          </tbody>
        </table>

      </div>

    </div>

  </div>
</div>

<ng-template #displayProducts>
  <tr *ngFor="let product of invoice.products$ | async">
    <td class="center">{{product.code}}</td>
    <td class="left">{{product.name}}</td>

    <td class="center">
      <input (change)="updateInvoiceProducts(product.id, {price: $event.target.valueAsNumber})" *ngIf="invoice.editMode"
             [ngModel]="product.price" class="form-control"
             type="number">
      <ng-container *ngIf="!invoice.editMode">{{product.price}}</ng-container>
    </td>
    <td class="center">
      <input (change)="updateInvoiceProducts(product.id, {quantity: $event.target.valueAsNumber})"
             *ngIf="invoice.editMode"
             [ngModel]="product.quantity" class="form-control"
             type="number">
      <ng-container *ngIf="!invoice.editMode">{{product.quantity}}</ng-container>
    </td>
    <td class="right">{{product.price * product.quantity}}</td>
  </tr>
</ng-template>
